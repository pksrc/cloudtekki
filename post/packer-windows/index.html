<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Automating Windows 10 VM build auto enrolled into UEM using Packer - Cloud Tekki</title><meta name="Description" content="Cloud Tekki aims to simplify and clarify technology concepts and solutions for those that strive to thrive"><meta property="og:title" content="Automating Windows 10 VM build auto enrolled into UEM using Packer" />
<meta property="og:description" content="In this post, I&rsquo;ll be covering how you can automate the process of building a Windows 10 images on your Lab. As a part of my daily job working with Workspace ONE Unified Endpoint Management, I work with a lot of Modern Management use cases and this requires testing various use cases on various versions of Windows 10. To always start with a clean image, I use Packer to build and enroll the device for me into my lab UEM tenant thus speeding up the process and reducing the probability for errors." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cloudtekki.com/post/packer-windows/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-22T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-10-03T21:26:42-07:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Automating Windows 10 VM build auto enrolled into UEM using Packer"/>
<meta name="twitter:description" content="In this post, I&rsquo;ll be covering how you can automate the process of building a Windows 10 images on your Lab. As a part of my daily job working with Workspace ONE Unified Endpoint Management, I work with a lot of Modern Management use cases and this requires testing various use cases on various versions of Windows 10. To always start with a clean image, I use Packer to build and enroll the device for me into my lab UEM tenant thus speeding up the process and reducing the probability for errors."/>
<meta name="application-name" content="Cloud Tekki">
<meta name="apple-mobile-web-app-title" content="Cloud Tekki"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://cloudtekki.com/post/packer-windows/" /><link rel="prev" href="https://cloudtekki.com/post/homelab-2021/" /><link rel="next" href="https://cloudtekki.com/post/access-migration/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><link rel="stylesheet" href="https://cloudtekki.com/css/ct.css"><meta name="google-site-verification" content="ToBeFilled" /><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Automating Windows 10 VM build auto enrolled into UEM using Packer",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/cloudtekki.com\/post\/packer-windows\/"
        },"genre": "posts","keywords": "Automation, Windows, Packer, UEM","wordcount":  1851 ,
        "url": "https:\/\/cloudtekki.com\/post\/packer-windows\/","datePublished": "2021-02-22T00:00:00+00:00","dateModified": "2021-10-03T21:26:42-07:00","publisher": {
            "@type": "Organization",
            "name": "Cloud Tekki"},"author": {
                "@type": "Person",
                "name": "Partheeban Kandasamy (PK)"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Cloud Tekki"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/img/logo/cloud-tekki-logo.png"
        data-srcset="/img/logo/cloud-tekki-logo.png, /img/logo/cloud-tekki-logo.png 1.5x, /img/logo/cloud-tekki-logo.png 2x"
        data-sizes="auto"
        alt="/img/logo/cloud-tekki-logo.png"
        title="/img/logo/cloud-tekki-logo.png" /></a>
        </div>
        <div class="menu navbar">
            <div class="menu-inner nav__links"><li data-expand="Posts" class="nav--link">
                        <a href="/posts/"><span class='menuicon'><img src='/img/menu/newspaper-solid.svg' class='transparent svg'/></span> Posts </a>
                    </li><li data-expand="Categories" class="nav--link">
                        <a href="/categories/"><span class='menuicon'><img src='/img/menu/folder-open-solid.svg' class='transparent svg'/></span> Categories </a>
                    </li><li data-expand="Tags" class="nav--link">
                        <a href="/tags/"><span class='menuicon'><img src='/img/menu/tags-solid.svg' class='transparent svg'/></span> Tags </a>
                    </li><li data-expand="About" class="nav--link">
                        <a href="/"><span class='menuicon'><img src='/img/menu/author-circle.svg' class='transparent svg'/></span> About </a>
                    </li><span class="menu-item">|</span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Enter keyword to search" id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Cloud Tekki"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/img/logo/cloud-tekki-logo.png"
        data-srcset="/img/logo/cloud-tekki-logo.png, /img/logo/cloud-tekki-logo.png 1.5x, /img/logo/cloud-tekki-logo.png 2x"
        data-sizes="auto"
        alt="/img/logo/cloud-tekki-logo.png"
        title="/img/logo/cloud-tekki-logo.png" /></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Enter keyword to search" id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title=""><span class='menuicon'><img src='/img/menu/newspaper-solid.svg' class='transparent svg'/></span>Posts</a><a class="menu-item" href="/categories/" title=""><span class='menuicon'><img src='/img/menu/folder-open-solid.svg' class='transparent svg'/></span>Categories</a><a class="menu-item" href="/tags/" title=""><span class='menuicon'><img src='/img/menu/tags-solid.svg' class='transparent svg'/></span>Tags</a><a class="menu-item" href="/" title=""><span class='menuicon'><img src='/img/menu/author-circle.svg' class='transparent svg'/></span>About</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>

        
<div class="tip"></div>

<section class="header__expandMenu">
  <div class="menu__container"><div id="Posts">
      <div class="sub__menu">
        <h3 class="title">Featured Posts</h3>
        <ul class="subMenu__items">
            <li class="subMenu--item">
              <i class="fa fa-star icon--production" style="color: gold;" aria-hidden="true"></i>
              <span class="label__container">
                <div class="label">
                  <a href="/post/registered-mode/"> Registered mode w/ a focus on Windows 10</a>
                  <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
                </div>
                <div class="label--desc">&nbsp;published on <b><time datetime="2021-10-03">2021-10-03</time></b></div>
              </span>
            </li>
            <li class="subMenu--item">
              <i class="fa fa-star icon--production" style="color: gold;" aria-hidden="true"></i>
              <span class="label__container">
                <div class="label">
                  <a href="/post/eso/"> Edge Services Observability for Unified Access Gateway</a>
                  <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
                </div>
                <div class="label--desc">&nbsp;published on <b><time datetime="2021-07-01">2021-07-01</time></b></div>
              </span>
            </li>
          </ul>
      </div>
    </div><div id="Categories">
      <div class="sub__menu">
        <h3 class="title">Categories</h3>
        <ul class="subMenu__items"><li class="subMenu--item item--one">
            <img src="/img/menu/folder-open-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/categories/euc/">EUC <sup>11</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/folder-open-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/categories/veba/">VEBA <sup>6</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/folder-open-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/categories/access/">ACCESS <sup>4</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/folder-open-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/categories/two-cents/">TWO CENTS <sup>4</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/folder-open-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/categories/sddc/">SDDC <sup>2</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/folder-open-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/categories/kubernetes/">KUBERNETES <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/folder-open-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/categories/uem/">UEM <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li></ul>
      </div>
    </div><div id="Tags">
      <div class="sub__menu">
        <h3 class="title">Tags</h3>
        <ul class="subMenu__items sec--menu"><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/cloud-native/">cloud-native <sup>6</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/event-driven/">event-driven <sup>6</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/access/">Access <sup>4</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/apis/">APIs <sup>4</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/people/">People <sup>4</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/insight/">Insight <sup>3</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/process/">Process <sup>3</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/automation/">Automation <sup>2</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/day2ops/">Day2Ops <sup>2</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/developertools/">DeveloperTools <sup>2</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/fling/">Fling <sup>2</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/kubernetes/">Kubernetes <sup>2</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/migration/">Migration <sup>2</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/monitoring/">Monitoring <sup>2</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/observability/">Observability <sup>2</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/postman/">Postman <sup>2</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li></ul>
          </div>
          <div class="sub__menu">
            <h3 class="title">&nbsp</h3>
          <ul class="subMenu__items sec--menu"><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/uem/">UEM <sup>2</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/vexpert/">vExpert <sup>2</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/workspaceone/">WorkspaceONE <sup>2</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/calico/">Calico <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/conditionalaccess/">ConditionalAccess <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/euc/">EUC <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/homelab/">homelab <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/hubservices/">HubServices <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/intelligence/">Intelligence <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/office365/">Office365 <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/packer/">Packer <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/projectpacific/">ProjectPacific <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/registeredmode/">RegisteredMode <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/serverless/">Serverless <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/tanzu/">Tanzu <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li></ul>
          </div>
          <div class="sub__menu">
            <h3 class="title">&nbsp</h3>
          <ul class="subMenu__items sec--menu"><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/templates/">Templates <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/tunnel/">Tunnel <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/ubuntu/">Ubuntu <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/windows/">Windows <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/windows10/">Windows10 <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li></ul>
      </div>
    </div>
    <div id="About">
      <div class="sub__menu">
        <h3 class="title">About</h3>
        <ul class="subMenu__items">
          
          <li class="subMenu--item">
            <i class='fas fa-user-circle fa-fw author'></i>
            <span class="label__container">
              <div class="label">
                <a href="/about-pk/">Partheeban Kandasamy (PK)</a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
              <div class="label--desc">
                <b>Sr. Product Manager @ VMW EUC</b> <br/> vExpert '20, '21 <br/> <b>Passion:</b> Automation, EUC, Cloud, Serverless, k8s, Homelab
              </div>
            </span>
          </li>
          
        </ul>
      </div>
    </div></div>
</section><main class="main">
                <div class="container"><article class="page single">
<aside class="sidebar" id="sidebar">
  <div id="sidebar-auto">
    <section class="sidebar_inner" id="SidebarNavigation">
      <h2 class="mt-4">Featured Posts</h2>
      <ul>
        <li>
          <a href="https://cloudtekki.com/post/registered-mode/" class="nav-link">Registered mode w/ a focus on Windows 10</a>
        </li>
        <li>
          <a href="https://cloudtekki.com/post/eso/" class="nav-link">Edge Services Observability for Unified Access Gateway</a>
        </li>
      </ul>

      <h2 class="mt-4">Recent Posts</h2>
      <ul class="flex-column">
        <li>
          <a href="https://cloudtekki.com/post/eso-2/" class="nav-link">Edge Services Observability - Part 2</a>
        </li>
        <li>
          <a href="https://cloudtekki.com/post/trusted-advisor/" class="nav-link">Being a Trusted Advisor</a>
        </li>
        <li>
          <a href="https://cloudtekki.com/post/it-team-challenges/" class="nav-link">The Top 5 IT Team Challenges</a>
        </li>
        <li>
          <a href="https://cloudtekki.com/post/field-lessons/" class="nav-link">Summing up Chapter 4, My Field Experiences</a>
        </li>
        <li>
          <a href="https://cloudtekki.com/post/registered-mode/" class="nav-link">Registered mode w/ a focus on Windows 10</a>
        </li>
      </ul>
        <div>
          <h2 class="mt-4 taxonomy" id="categories-section">TOP Categories</h2>
          <nav class="tags_nav">
            <a href='https://cloudtekki.com/categories/euc/' class="post_tag button button_translucent">
              EUC
              <span class="button_tally">11</span>
            </a>
            
            <a href='https://cloudtekki.com/categories/veba/' class="post_tag button button_translucent">
              VEBA
              <span class="button_tally">6</span>
            </a>
            
            <a href='https://cloudtekki.com/categories/access/' class="post_tag button button_translucent">
              ACCESS
              <span class="button_tally">4</span>
            </a>
            
            <a href='https://cloudtekki.com/categories/two-cents/' class="post_tag button button_translucent">
              TWO-CENTS
              <span class="button_tally">4</span>
            </a>
            
            <a href='https://cloudtekki.com/categories/sddc/' class="post_tag button button_translucent">
              SDDC
              <span class="button_tally">2</span>
            </a>
            
          </nav>
        </div>
        <div>
          <h2 class="mt-4 taxonomy" id="tags-section">TOP Tags</h2>
          <nav class="tags_nav">
            <a href='https://cloudtekki.com/tags/cloud-native/' class="post_tag button button_translucent">
              CLOUD-NATIVE
              <span class="button_tally">6</span>
            </a>
            
            <a href='https://cloudtekki.com/tags/event-driven/' class="post_tag button button_translucent">
              EVENT-DRIVEN
              <span class="button_tally">6</span>
            </a>
            
            <a href='https://cloudtekki.com/tags/access/' class="post_tag button button_translucent">
              ACCESS
              <span class="button_tally">4</span>
            </a>
            
            <a href='https://cloudtekki.com/tags/apis/' class="post_tag button button_translucent">
              APIS
              <span class="button_tally">4</span>
            </a>
            
            <a href='https://cloudtekki.com/tags/people/' class="post_tag button button_translucent">
              PEOPLE
              <span class="button_tally">4</span>
            </a>
            
          </nav>
        </div>
    </section>
  </div>
</aside>
<h1 class="single-title animated flipInX">Automating Windows 10 VM build auto enrolled into UEM using Packer</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/about-pk/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Partheeban Kandasamy (PK)</a></span>&nbsp;<span class="post-category">included in <a href="/categories/euc/"><i class="far fa-folder fa-fw"></i>EUC</a></span><span class="sharebtns"><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://cloudtekki.com/post/packer-windows/" data-title="Automating Windows 10 VM build auto enrolled into UEM using Packer" data-via="pkblah" data-hashtags="Automation,Windows,Packer,UEM"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="https://cloudtekki.com/post/packer-windows/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="Share on WhatsApp" data-sharer="whatsapp" data-url="https://cloudtekki.com/post/packer-windows/" data-title="Automating Windows 10 VM build auto enrolled into UEM using Packer" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="Share on Reddit" data-sharer="reddit" data-url="https://cloudtekki.com/post/packer-windows/"><i class="fab fa-reddit fa-fw"></i></a><a href="javascript:void(0);" title="Share on Blogger" data-sharer="blogger" data-url="https://cloudtekki.com/post/packer-windows/" data-title="Automating Windows 10 VM build auto enrolled into UEM using Packer" data-description=""><i class="fab fa-blogger fa-fw"></i></a></span>
            </div>
            <div class="post-meta-line">
                <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/automation/">Automation</a>,&nbsp;<a href="/tags/windows/">Windows</a>,&nbsp;<a href="/tags/packer/">Packer</a>,&nbsp;<a href="/tags/uem/">UEM</a></section><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-02-22">2021-02-22</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1851 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;9 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-packer">What is Packer?</a>
      <ul>
        <li><a href="#packer-use-cases">Packer Use Cases</a></li>
      </ul>
    </li>
    <li><a href="#how-do-i-use-it">How do I use it?</a></li>
    <li><a href="#getting-started">Getting started</a>
      <ul>
        <li><a href="#macos-installation">macOS Installation</a></li>
      </ul>
    </li>
    <li><a href="#terminologies">Terminologies</a></li>
    <li><a href="#template-for-windows">Template for Windows</a>
      <ul>
        <li><a href="#variables">Variables</a></li>
        <li><a href="#vsphere-iso-builder">vSphere ISO Builder</a></li>
        <li><a href="#autounattend-file">AutoUnattend File</a></li>
      </ul>
    </li>
    <li><a href="#starting-the-build">Starting the Build</a>
      <ul>
        <li><a href="#build-process">Build process</a></li>
        <li><a href="#enrollment-into-uem">Enrollment into UEM</a></li>
      </ul>
    </li>
    <li><a href="#wrap-up">Wrap Up</a>
      <ul>
        <li><a href="#psupgrading-packer-to-170">PS:Upgrading Packer to 1.7.0</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>In this post, I&rsquo;ll be covering how you can automate the process of building a Windows 10 images on your Lab. As a part of my daily job working with Workspace ONE Unified Endpoint Management, I work with a lot of Modern Management use cases and this requires testing various use cases on various versions of Windows 10. To always start with a clean image, I use Packer to build and enroll the device for me into my lab UEM tenant thus speeding up the process and reducing the probability for errors.</p>
<p>Let&rsquo;s dive into how you can get started with Packer to automate the entire Windows 10 build process along with enrolling into Workspace ONE UEM without a single click&hellip;</p>
<h2 id="what-is-packer">What is Packer?</h2>
<p>If you are not familiar with Packer, <a href="https://www.packer.io/" target="_blank">Packer</a> by Hashicorp is a tool that helps automate the images building process for multiple platforms such as AWS, Azure, GCP, VMware(all at the same time, if you choose to). With Packer you can attempt to build a very consistent image every time by automating the steps to build an image through code.</p>
<h3 id="packer-use-cases">Packer Use Cases</h3>
<p>Several use cases are highlighted <a href="https://www.packer.io/intro/use-cases" target="_blank">here</a></p>
<ul>
<li><a href="https://www.packer.io/intro/use-cases#continuous-delivery" target="_blank">Continuous Delivery</a></li>
<li><a href="https://www.packer.io/intro/use-cases#dev-prod-parity" target="_blank">Dev/Prod Parity</a></li>
<li><a href="https://www.packer.io/intro/use-cases#appliance-demo-creation" target="_blank">Appliance/Demo Creation</a></li>
</ul>
<h2 id="how-do-i-use-it">How do I use it?</h2>
<ol>
<li>Since I have the need to work with a lot of Windows 10 (in EUC) for Endpoint Management, I use the Packer to build a VM for the version of Windows 10 that I need in under 30 minutes. My homelab has little storage and thus rather than creating templates, I leaned heavily on Packer which helps minimizing the storage used. Once I have the working set of build files for an Operating System + version, I can always replicate the Image (most of the time barring some unexpected OS update behaviors).</li>
<li>Packer is also used to produce the <a href="vmweventbroker.io">VMware Event Broker Appliance</a> and it was in fact William Lam <a href="https://twitter.com/lamw?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-size="small" data-related="pkblah" data-show-screen-name="false"  data-show-count="false">Follow</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> who first introduced me to the magic of Packer and how capable it is to build consistent images</li>
</ol>
<h2 id="getting-started">Getting started</h2>
<p>You can get started by installing packer on your operating system as described <a href="https://learn.hashicorp.com/tutorials/packer/getting-started-install" target="_blank">here</a></p>
<h3 id="macos-installation">macOS Installation</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">brew tap hashicorp/tap
</span></span><span class="line"><span class="cl">brew install hashicorp/tap/packer
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="terminologies">Terminologies</h2>
<p>If you are going to work with Packer, you&rsquo;ll need to know these common terminologies</p>
<ul>
<li><strong>Variables</strong>: self explanatory - define any and all your variables here.. these will be used in the following sections</li>
<li><strong>Builder(s)</strong>: These are platform specific using various APIs to product consistent images across various platforms such as AWS, Azure, GCP, VMware</li>
<li><strong>Provisioners</strong>: does stuff to configure the image after booting - such as installing packages</li>
<li><strong>Post Processors</strong>: runs after the image is built - such as exporting the VM as an OVA</li>
</ul>
<h2 id="template-for-windows">Template for Windows</h2>
<p>Let&rsquo;s go over the details of the Packer template that I&rsquo;ve leveraged for the Windows 10 build. You can find the template that I&rsquo;ve used in my github repo - <a href="https://github.com/pksrc/packer" target="_blank">https://github.com/pksrc/packer</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">git clone https://github.com/pksrc/packer.git 
</span></span><span class="line"><span class="cl">cd packer/win10
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="variables">Variables</h3>
<p>All the variables that we are going to use are split up into two files for readability</p>
<ul>
<li><code>var-appliance.json</code> - has all the information about the Appliance such as name, CPU, disk size etc</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;0.1.0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Windows Image&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;vm_name&#34;</span><span class="p">:</span> <span class="s2">&#34;Windows_10&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;numvcpus&#34;</span><span class="p">:</span> <span class="s2">&#34;2&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;memory&#34;</span><span class="p">:</span> <span class="s2">&#34;4096&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;disk_size&#34;</span><span class="p">:</span> <span class="s2">&#34;50720&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;guest_username&#34;</span><span class="p">:</span> <span class="s2">&#34;vmuser&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;guest_password&#34;</span><span class="p">:</span> <span class="s2">&#34;VM@Windows10&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;autounattend&#34;</span><span class="p">:</span> <span class="s2">&#34;./answer/10/Autounattend.xml&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="err">....</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>var-builder.json</code> - has all the information about the platform where we are going to build the VM</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;vcenter_server&#34;</span><span class="p">:</span> <span class="s2">&#34;10.10.X.X&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;vcenter_username&#34;</span><span class="p">:</span> <span class="s2">&#34;administrator@vsphere.local&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;vcenter_password&#34;</span><span class="p">:</span> <span class="s2">&#34;P@ssword&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;VM_folder&#34;</span><span class="p">:</span> <span class="s2">&#34;Templates&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;esx_host&#34;</span><span class="p">:</span> <span class="s2">&#34;CMD/esxi03.lab.pdotk.com&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;resource_pool&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;datastore&#34;</span><span class="p">:</span> <span class="s2">&#34;datastore2-30&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;network&#34;</span><span class="p">:</span> <span class="s2">&#34;dPG-Access&#34;</span> <span class="err">#Connect</span> <span class="err">to</span> <span class="err">the</span> <span class="err">Network</span> <span class="err">with</span> <span class="err">DHCP</span> <span class="err">enabled</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="vsphere-iso-builder">vSphere ISO Builder</h3>
<p>We are going to be using the vSphere 7.0 platform for building our VMs and thus using <code>vsphere-iso</code> which leverages vSphere API (supports vSphere 6.5+).</p>
<blockquote>
<p>If you don&rsquo;t have a vCenter and are going to be building directly on your ESXi host(s) you can leverage the <code>vmware-iso</code> which requires some ESXi modification as it needs SSH access and leverages VNC</p>
</blockquote>
<p>Let&rsquo;s now walk through all the options specified below</p>
<ul>
<li><strong>type</strong>: indicates the builder that we are going to leverage and we are going to be using <code>vsphere-iso</code> (obviously)</li>
<li><strong>build platform information</strong> - information about which vCenter we are going to connect to, the necessary credentials, what datastore and resource pool are going to be used, is vCenter certificate trusted etc.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;vsphere-iso&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;vcenter_server&#34;</span><span class="p">:</span> <span class="s2">&#34;{{user `vcenter_server`}}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;host&#34;</span><span class="p">:</span> <span class="s2">&#34;{{user `esx_host`}}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;resource_pool&#34;</span><span class="p">:</span> <span class="s2">&#34;{{user `resource_pool`}}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;datastore&#34;</span><span class="p">:</span> <span class="s2">&#34;{{user `datastore`}}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;username&#34;</span><span class="p">:</span> <span class="s2">&#34;{{user `vcenter_username`}}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;password&#34;</span><span class="p">:</span> <span class="s2">&#34;{{user `vcenter_password`}}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;insecure_connection&#34;</span><span class="p">:</span> <span class="s2">&#34;true&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="err">....</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>ISO</strong>: You&rsquo;ll need to provide two ISOs for the Windows Image to build succesfully
<ol>
<li><strong>The bootable Windows 10 ISO</strong> - you can provide both the local downloaded file path and/or the remote URL to download from. A checksum to the file needs to be provided for added security.</li>
<li>Since <strong>VMware Tools</strong> will also be needed, we&rsquo;ll need to upload the VMware Tools to the datastore and mount it using <code>iso_paths</code> attribute. A word of caution as there are no validations for the presence of files on the datastore. If you don&rsquo;t have the file you could be staring at a black screen on the VM for a long time wondering why the boot screen is not coming up, ask me how I know..</li>
</ol>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="err">....</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;iso_urls&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;{{user `local_iso_path`}}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;{{user `remote_iso_url`}}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;iso_checksum&#34;</span><span class="p">:</span> <span class="s2">&#34;db756063e9efa39c68501f745c2ea9c0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;iso_paths&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;[{{user `datastore`}}] {{user `vmtools_windows`}}&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="err">...or...</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;iso_paths&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;[{{user `datastore`}}] {{user `iso_url`}}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;[{{user `datastore`}}] {{user `vmtools_windows`}}&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="err">....</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>VM information</strong> - Name, VM version, Guest OS Type, CPU, RAM, storage and networking information</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="err">....</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;vm_name&#34;</span><span class="p">:</span> <span class="s2">&#34;{{user `vm_name`}}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;notes&#34;</span><span class="p">:</span> <span class="s2">&#34;{{user `description`}} - {{user `version`}}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;vm_version&#34;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;guest_os_type&#34;</span><span class="p">:</span> <span class="s2">&#34;windows9_64Guest&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;cpus&#34;</span><span class="p">:</span> <span class="s2">&#34;{{user `numvcpus`}}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;ram&#34;</span><span class="p">:</span> <span class="s2">&#34;{{user `memory`}}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;disk_controller_type&#34;</span><span class="p">:</span> <span class="s2">&#34;pvscsi&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;storage&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;disk_size&#34;</span><span class="p">:</span> <span class="s2">&#34;{{user `disk_size`}}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;disk_thin_provisioned&#34;</span><span class="p">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;network_adapters&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;network&#34;</span><span class="p">:</span> <span class="s2">&#34;{{user `network`}}&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="err">....</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>Seed Files</strong>: We can seed some files through the floppy files and these are then leveraged during the <code>autounattend</code> setup</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="err">....</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;floppy_files&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;{{user `autounattend`}}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;./floppy/WindowsPowershell.lnk&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;./floppy/PinTo10.exe&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;./floppy/vmtools.cmd&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;./scripts/fixnetwork.ps1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;./scripts/disable-screensaver.ps1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;./scripts/disable-winrm.ps1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;./scripts/enable-winrm.ps1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;./scripts/microsoft-updates.bat&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;./scripts/win-updates.ps1&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;floppy_img_path&#34;</span><span class="p">:</span> <span class="s2">&#34;[{{user `datastore`}}] VMware-Tools-windows-11.0.0-14549434/floppies/pvscsi-Windows8.flp&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="err">....</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>WinRM config</strong> - options configuring the WinRM communication that we need for connecting the the VM after booting - how long should Packer wait for a reboot, how should packer authenticate with the Guest etc.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="err">....</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;communicator&#34;</span><span class="p">:</span> <span class="s2">&#34;winrm&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;winrm_timeout&#34;</span><span class="p">:</span> <span class="s2">&#34;{{user `winrm_timeout`}}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;winrm_password&#34;</span><span class="p">:</span> <span class="s2">&#34;{{user `guest_password`}}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;winrm_username&#34;</span><span class="p">:</span> <span class="s2">&#34;{{user `guest_username`}}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;boot_wait&#34;</span><span class="p">:</span> <span class="s2">&#34;{{user `restart_timeout`}}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;shutdown_command&#34;</span><span class="p">:</span> <span class="s2">&#34;shutdown /s /t 10 /f /d p:4:1 /c \&#34;Packer Shutdown\&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;ip_wait_timeout&#34;</span><span class="p">:</span> <span class="s2">&#34;{{user `ip_wait_timeout`}}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="err">....</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="autounattend-file">AutoUnattend File</h3>
<p>Every OS has its own method to support an automated build. For the Windows, we want to focus on the <code>autounattend</code> file as described <a href="https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/automate-windows-setup" target="_blank">here</a> and <a href="https://www.packer.io/guides/automatic-operating-system-installs/autounattend_windows" target="_blank">here</a></p>
<p>It might be hard to cover the <code>Unattend</code> file at length and thus I&rsquo;ve provided the high-level details along with how there are utilized below (excerpt from MSFT <a href="https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/update-windows-settings-and-scripts-create-your-own-answer-file-sxs" target="_blank">documentation</a> where you can easily get lost in the labyrinth of hyperlinks)</p>
<ul>
<li>
<p><strong>windowsPE</strong>: These settings are used by the Windows Setup installation program. We use this to <a href="https://kb.vmware.com/s/article/1010398" target="_blank">install the PVCSCI drive</a> which is our <code>disk_controller_type</code></p>
</li>
<li>
<p><strong>specialize</strong>: You can have multiple blocks of <code>specialize</code></p>
<ul>
<li>These settings are triggered both at the beginning of audit mode and at the beginning of OOBE. We use this to setup the disk partitions, language settings, User settings, Product Key etc. You could also setup static IP (which I&rsquo;m not using)</li>
<li>Use to install VMware Tools on the Guest OS</li>
<li>Use for Naming the VM</li>
</ul>
</li>
<li>
<p><strong>oobeSystem</strong>: The suggestion is to use this sparingly however we use this heavily to configure the system after the user completes OOBE.</p>
</li>
</ul>
<p>A good reference to an example Autounattend file and all the helper scripts are available in Stefan Scherer&rsquo;s repo - <a href="https://github.com/StefanScherer/packer-windows" target="_blank">https://github.com/StefanScherer/packer-windows</a> (forked from <a href="https://github.com/joefitzgerald/packer-windows%29" target="_blank">https://github.com/joefitzgerald/packer-windows)</a>. This repo provides examples that uses the <code>vmware-iso</code> builder that is being utilized. My repo has a modified version of this to help build succesfully on vSphere - <a href="https://github.com/pksrc/packer" target="_blank">https://github.com/pksrc/packer</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">git clone https://github.com/pksrc/packer.git 
</span></span><span class="line"><span class="cl">cd packer/win10
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="starting-the-build">Starting the Build</h2>
<p>Starting the build is easily done with the <code>packer</code> command which should kick off the build process on vCenter using the configuration provided</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">packer build \
</span></span><span class="line"><span class="cl">    --only=vsphere-iso \ #if there are multiple builders, this builds only the vsphere-iso configuration
</span></span><span class="line"><span class="cl">    --var-file=var-builder.json \ 
</span></span><span class="line"><span class="cl">    --var-file=var-appliance.json \ 
</span></span><span class="line"><span class="cl">    --var iso_url=packer_cache/en_windows_10_business_editions_version_2004_x64_dvd_d06ef8c5.iso \ 
</span></span><span class="line"><span class="cl">    --var vm_name=&#34;Windows10_2004&#34; \ 
</span></span><span class="line"><span class="cl">    windows_10.json
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="build-process">Build process</h3>
<p>As a part of the build process,</p>
<ul>
<li>the Windows 10 ISO is uploaded to vCenter onto the datastore specified</li>
<li>the VM is created and booted up from the ISO uploaded</li>
<li>the VMware Tools is first installed and forces a reboot</li>
<li>the Windows Setup begins leveraging the autounattend and the supporting script files made available in the floppy drives</li>
<li>the autounattend process also runs the scripts to help configure some settings on the VM</li>
<li>the VM is configured to auto logon with a User specified in the AutoUnattend.xml</li>
<li>Packer is able to acquire the IP once the Windows is configured on the VM</li>
<li>the provisioning stage now kick in and starts to execute each block - it is here that we attempt to also enroll the VM into UEM</li>
<li>once the provisioning stage is over, the post processor kicks in - I&rsquo;m only writing a success message here</li>
</ul>
<p>The entire process took 30 minutes can be seen in this video(sped up to 5 mins) below -</p>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube-nocookie.com/embed/pVUVSoi1J2U" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>
<h3 id="enrollment-into-uem">Enrollment into UEM</h3>
<p>Using the Post provisioning step, we tell packer to run the below script which will download the <code>AirwatchAgent.msi</code> and enroll the device into Workspace ONE UEM.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bat" data-lang="bat"><span class="line"><span class="cl"><span class="k">if</span> <span class="k">not</span> <span class="k">exist</span> <span class="s2">&#34;C:\tmp\AirWatchAgent.msi&#34;</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	powershell -Command <span class="s2">&#34;(New-Object System.Net.WebClient).DownloadFile(&#39;https://packages.vmware.com/wsone/AirwatchAgent.msi&#39;, &#39;C:\tmp\AirWatchAgent.msi&#39;)&#34;</span> <span class="p">&lt;</span>NUL
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">rem Check if device is already registered with Workspace ONE, if not then proceed with installing Workspace ONE Intelligent Hub</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="k">/f</span> <span class="s2">&#34;delims=&#34;</span> <span class="se">%%</span>i <span class="k">in</span> <span class="p">(</span><span class="s2">&#34;reg query HKLM\SOFTWARE\Microsoft\Provisioning\OMADM\Accounts /s&#34;</span><span class="p">)</span> <span class="k">do</span> <span class="k">set</span> <span class="nv">status</span><span class="p">=</span><span class="se">%%</span>i
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="k">not</span> <span class="k">defined</span> <span class="nv">status</span> <span class="k">goto</span> <span class="nl">INSTALL</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">:</span><span class="nl">INSTALL</span>
</span></span><span class="line"><span class="cl">    <span class="c1">rem Run the Workspace ONE Intelligent Hub Installer to Register Device with Staging Account</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    msiexec /i C:\tmp\AirWatchAgent.msi /q ENROLL=Y SERVER=uem.lab.pdotk.com LGName=customerog USERNAME=test@lab.pdotk.com PASSWORD=P@ssw0rd DOWNLOADWSBUNDLE=TRUE /LOG <span class="nv">%temp%</span>\WorkspaceONE.log
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="wrap-up">Wrap Up</h2>
<p>Hopefully this post helps you get started with packer quickly and with your Windows 10 use cases. I&rsquo;ve shown an example where I was able to auto enroll into UEM and have a fresh image always ready to test within a span of 30 minutes but the possibilities with automation enabled by packer are endless&hellip; Hoping you&rsquo;ll give it a try! </p>
<h3 id="psupgrading-packer-to-170">PS:Upgrading Packer to 1.7.0</h3>
<p>I&rsquo;ve been using Packer for 6-9 months now and had finalized my templates mostly. However at the time of posting this, Packer has introduced some changes with v1.7.0 which suggests an template upgrade. I&rsquo;ll be covering these changes in the next blog post.</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2021-10-03&nbsp;<a class="git-hash" href="https://github.com/pksrc/commit/38b782a496ad522313022455e0faab90a281fe76" target="_blank" title="commit by pksrc(partheeban.kandasamy@gmail.com) 38b782a496ad522313022455e0faab90a281fe76: Post: Registered Mode on Windows">
                                    <i class="fas fa-hashtag fa-fw"></i>38b782a</a></span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share sharebtns">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://cloudtekki.com/post/packer-windows/" data-title="Automating Windows 10 VM build auto enrolled into UEM using Packer" data-via="pkblah" data-hashtags="Automation,Windows,Packer,UEM"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="https://cloudtekki.com/post/packer-windows/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="Share on WhatsApp" data-sharer="whatsapp" data-url="https://cloudtekki.com/post/packer-windows/" data-title="Automating Windows 10 VM build auto enrolled into UEM using Packer" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="Share on Reddit" data-sharer="reddit" data-url="https://cloudtekki.com/post/packer-windows/"><i class="fab fa-reddit fa-fw"></i></a><a href="javascript:void(0);" title="Share on Blogger" data-sharer="blogger" data-url="https://cloudtekki.com/post/packer-windows/" data-title="Automating Windows 10 VM build auto enrolled into UEM using Packer" data-description=""><i class="fab fa-blogger fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/automation/">Automation</a>,&nbsp;<a href="/tags/windows/">Windows</a>,&nbsp;<a href="/tags/packer/">Packer</a>,&nbsp;<a href="/tags/uem/">UEM</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/post/homelab-2021/" class="prev" rel="prev" title="2021: What&#39;s in my homelab?"><i class="fas fa-angle-left fa-fw"></i>2021: What&#39;s in my homelab?</a>
            <a href="/post/access-migration/" class="next" rel="next" title="Fling: Migration tool for WS1 Access">Fling: Migration tool for WS1 Access<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="utterances"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://utteranc.es/">Utterances</a>.
            </noscript></div></article><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div><h2 class="twitter-title">TWEETS</h2>
            <div class="twitterfeed" id="twitter-auto" >
                <a class="twitter-timeline" data-width="300" data-height="600" data-dnt="true" data-chrome="noborders nofooter noheader" href="https://twitter.com/pkblah">Tweets by pkblah</a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 
            </div></div></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><p><a href="/"><img src="/img/logo/cloud-tekki-logo.png" alt="CLOUD TEKKI" style="height:4rem"/></a></p> Powered by Hugo | Github Pages</div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2008 - 2022</span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.8/lunr.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/js/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.2.0/dist/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":80},"comment":{"utterances":{"darkTheme":"github-dark","issueTerm":"pathname","label":"","lightTheme":"github-light","repo":"pksrc/cloudtekki"}},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/lib/stripe-menu/menu.js"></script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-RYVG6M042F', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-RYVG6M042F" async></script></body>
</html>
