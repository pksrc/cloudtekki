<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Securing Outlook from Unmanaged Devices with Tunnel - Cloud Tekki</title><meta name="Description" content="Cloud Tekki aims to simplify and clarify technology concepts and solutions for those that strive to thrive"><meta property="og:title" content="Securing Outlook from Unmanaged Devices with Tunnel" />
<meta property="og:description" content="Howdy! I&rsquo;m Kevin Ten Eyck, a Staff EUC Customer Success Architect at VMware. I&rsquo;ve been with VMware for 4 years and greatly enjoy all things EUC! Coming from a background in Mobility and VDI, I love finding new challenges to be solved. Would love to hear your feedback or alternate ideas on how you&rsquo;ve solved similar problems!
What problem does this solve? This blog post is targeted at Workspace ONE UEM administrators who are being asked to prevent unmanaged devices from accessing Office 365 applications." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cloudtekki.com/post/tunnel-o365-conditional-access/" />
<meta property="article:published_time" content="2021-07-06T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-07-09T13:47:29-05:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Securing Outlook from Unmanaged Devices with Tunnel"/>
<meta name="twitter:description" content="Howdy! I&rsquo;m Kevin Ten Eyck, a Staff EUC Customer Success Architect at VMware. I&rsquo;ve been with VMware for 4 years and greatly enjoy all things EUC! Coming from a background in Mobility and VDI, I love finding new challenges to be solved. Would love to hear your feedback or alternate ideas on how you&rsquo;ve solved similar problems!
What problem does this solve? This blog post is targeted at Workspace ONE UEM administrators who are being asked to prevent unmanaged devices from accessing Office 365 applications."/>
<meta name="application-name" content="Cloud Tekki">
<meta name="apple-mobile-web-app-title" content="Cloud Tekki"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://cloudtekki.com/post/tunnel-o365-conditional-access/" /><link rel="prev" href="https://cloudtekki.com/post/eso/" /><link rel="next" href="https://cloudtekki.com/post/the-flip-side/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><link rel="stylesheet" href="https://cloudtekki.com/css/ct.css"><meta name="google-site-verification" content="ToBeFilled" /><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Securing Outlook from Unmanaged Devices with Tunnel",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/cloudtekki.com\/post\/tunnel-o365-conditional-access\/"
        },"genre": "posts","keywords": "Tunnel, Office365, ConditionalAccess, WorkspaceONE","wordcount":  2474 ,
        "url": "https:\/\/cloudtekki.com\/post\/tunnel-o365-conditional-access\/","datePublished": "2021-07-06T00:00:00+00:00","dateModified": "2021-07-09T13:47:29-05:00","publisher": {
            "@type": "Organization",
            "name": "Cloud Tekki"},"author": {
                "@type": "Person",
                "name": "Kevin Ten Eyck"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Cloud Tekki"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/img/logo/cloud-tekki-logo.png"
        data-srcset="/img/logo/cloud-tekki-logo.png, /img/logo/cloud-tekki-logo.png 1.5x, /img/logo/cloud-tekki-logo.png 2x"
        data-sizes="auto"
        alt="/img/logo/cloud-tekki-logo.png"
        title="/img/logo/cloud-tekki-logo.png" /></a>
        </div>
        <div class="menu navbar">
            <div class="menu-inner nav__links"><li data-expand="Posts" class="nav--link">
                        <a href="/posts/"><span class='menuicon'><img src='/img/menu/newspaper-solid.svg' class='transparent svg'/></span> Posts </a>
                    </li><li data-expand="Categories" class="nav--link">
                        <a href="/categories/"><span class='menuicon'><img src='/img/menu/folder-open-solid.svg' class='transparent svg'/></span> Categories </a>
                    </li><li data-expand="Tags" class="nav--link">
                        <a href="/tags/"><span class='menuicon'><img src='/img/menu/tags-solid.svg' class='transparent svg'/></span> Tags </a>
                    </li><li data-expand="About" class="nav--link">
                        <a href="/"><span class='menuicon'><img src='/img/menu/author-circle.svg' class='transparent svg'/></span> About </a>
                    </li><span class="menu-item">|</span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Enter keyword to search" id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Cloud Tekki"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/img/logo/cloud-tekki-logo.png"
        data-srcset="/img/logo/cloud-tekki-logo.png, /img/logo/cloud-tekki-logo.png 1.5x, /img/logo/cloud-tekki-logo.png 2x"
        data-sizes="auto"
        alt="/img/logo/cloud-tekki-logo.png"
        title="/img/logo/cloud-tekki-logo.png" /></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Enter keyword to search" id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title=""><span class='menuicon'><img src='/img/menu/newspaper-solid.svg' class='transparent svg'/></span>Posts</a><a class="menu-item" href="/categories/" title=""><span class='menuicon'><img src='/img/menu/folder-open-solid.svg' class='transparent svg'/></span>Categories</a><a class="menu-item" href="/tags/" title=""><span class='menuicon'><img src='/img/menu/tags-solid.svg' class='transparent svg'/></span>Tags</a><a class="menu-item" href="/" title=""><span class='menuicon'><img src='/img/menu/author-circle.svg' class='transparent svg'/></span>About</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>

        
<div class="tip"></div>

<section class="header__expandMenu">
  <div class="menu__container"><div id="Posts">
      <div class="sub__menu">
        <h3 class="title">Featured Posts</h3>
        <ul class="subMenu__items">
            <li class="subMenu--item">
              <i class="fa fa-star icon--production" style="color: gold;" aria-hidden="true"></i>
              <span class="label__container">
                <div class="label">
                  <a href="/post/registered-mode/"> Registered mode w/ a focus on Windows 10</a>
                  <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
                </div>
                <div class="label--desc">&nbsp;published on <b><time datetime="2021-10-03">2021-10-03</time></b></div>
              </span>
            </li>
            <li class="subMenu--item">
              <i class="fa fa-star icon--production" style="color: gold;" aria-hidden="true"></i>
              <span class="label__container">
                <div class="label">
                  <a href="/post/eso/"> Edge Services Observability for Unified Access Gateway</a>
                  <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
                </div>
                <div class="label--desc">&nbsp;published on <b><time datetime="2021-07-01">2021-07-01</time></b></div>
              </span>
            </li>
          </ul>
      </div>
    </div><div id="Categories">
      <div class="sub__menu">
        <h3 class="title">Categories</h3>
        <ul class="subMenu__items"><li class="subMenu--item item--one">
            <img src="/img/menu/folder-open-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/categories/euc/">EUC <sup>10</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/folder-open-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/categories/veba/">VEBA <sup>6</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/folder-open-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/categories/access/">ACCESS <sup>4</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/folder-open-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/categories/two-cents/">TWO CENTS <sup>4</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/folder-open-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/categories/author-notes/">AUTHOR NOTES <sup>3</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/folder-open-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/categories/sddc/">SDDC <sup>2</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/folder-open-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/categories/kubernetes/">KUBERNETES <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/folder-open-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/categories/uem/">UEM <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li></ul>
      </div>
    </div><div id="Tags">
      <div class="sub__menu">
        <h3 class="title">Tags</h3>
        <ul class="subMenu__items sec--menu"><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/cloud-native/">cloud-native <sup>6</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/event-driven/">event-driven <sup>6</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/access/">Access <sup>4</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/apis/">APIs <sup>4</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/people/">People <sup>4</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/authornotes/">AuthorNotes <sup>3</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/insight/">Insight <sup>3</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/process/">Process <sup>3</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/automation/">Automation <sup>2</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/developertools/">DeveloperTools <sup>2</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/fling/">Fling <sup>2</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/kubernetes/">Kubernetes <sup>2</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/migration/">Migration <sup>2</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/postman/">Postman <sup>2</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/uem/">UEM <sup>2</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/vexpert/">vExpert <sup>2</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li></ul>
          </div>
          <div class="sub__menu">
            <h3 class="title">&nbsp</h3>
          <ul class="subMenu__items sec--menu"><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/workspaceone/">WorkspaceONE <sup>2</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/calico/">Calico <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/conditionalaccess/">ConditionalAccess <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/day2ops/">Day2Ops <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/euc/">EUC <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/homelab/">homelab <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/hubservices/">HubServices <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/intelligence/">Intelligence <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/monitoring/">Monitoring <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/observability/">Observability <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/office365/">Office365 <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/packer/">Packer <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/projectpacific/">ProjectPacific <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/registeredmode/">RegisteredMode <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/tanzu/">Tanzu <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li></ul>
          </div>
          <div class="sub__menu">
            <h3 class="title">&nbsp</h3>
          <ul class="subMenu__items sec--menu"><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/templates/">Templates <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/tunnel/">Tunnel <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/ubuntu/">Ubuntu <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/windows/">Windows <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li><li class="subMenu--item item--one">
            <img src="/img/menu/tags-solid.svg" class="icon">
            <span class="label__container">
              <div class="label">
                <a href="/tags/windows10/">Windows10 <sup>1</sup></a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </span>
          </li></ul>
      </div>
    </div>
    <div id="About">
      <div class="sub__menu">
        <h3 class="title">About</h3>
        <ul class="subMenu__items">
          
          <li class="subMenu--item">
            <i class='fas fa-user-circle fa-fw author'></i>
            <span class="label__container">
              <div class="label">
                <a href="/about-pk/">Partheeban Kandasamy (PK)</a>
                <svg class="right--arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
              <div class="label--desc">
                <b>Sr. Product Manager @ VMW EUC</b> <br/> vExpert '20, '21 <br/> <b>Passion:</b> Automation, EUC, Cloud, Serverless, k8s, Homelab
              </div>
            </span>
          </li>
          
        </ul>
      </div>
    </div></div>
</section><main class="main">
                <div class="container"><article class="page single">
<aside class="sidebar" id="sidebar">
  <div id="sidebar-auto">
    <section class="sidebar_inner" id="SidebarNavigation">
      <h2 class="mt-4">Featured Posts</h2>
      <ul>
        <li>
          <a href="https://cloudtekki.com/post/registered-mode/" class="nav-link">Registered mode w/ a focus on Windows 10</a>
        </li>
        <li>
          <a href="https://cloudtekki.com/post/eso/" class="nav-link">Edge Services Observability for Unified Access Gateway</a>
        </li>
      </ul>

      <h2 class="mt-4">Recent Posts</h2>
      <ul class="flex-column">
        <li>
          <a href="https://cloudtekki.com/post/looking-back-at-2021/" class="nav-link">2021: Taking Back The Reins</a>
        </li>
        <li>
          <a href="https://cloudtekki.com/post/trusted-advisor/" class="nav-link">Being a Trusted Advisor</a>
        </li>
        <li>
          <a href="https://cloudtekki.com/post/it-team-challenges/" class="nav-link">The Top 5 IT Team Challenges</a>
        </li>
        <li>
          <a href="https://cloudtekki.com/post/field-lessons/" class="nav-link">Summing up Chapter 4, My Field Experiences</a>
        </li>
        <li>
          <a href="https://cloudtekki.com/post/registered-mode/" class="nav-link">Registered mode w/ a focus on Windows 10</a>
        </li>
      </ul>
        <div>
          <h2 class="mt-4 taxonomy" id="categories-section">TOP Categories</h2>
          <nav class="tags_nav">
            <a href='https://cloudtekki.com/categories/euc/' class="post_tag button button_translucent">
              EUC
              <span class="button_tally">10</span>
            </a>
            
            <a href='https://cloudtekki.com/categories/veba/' class="post_tag button button_translucent">
              VEBA
              <span class="button_tally">6</span>
            </a>
            
            <a href='https://cloudtekki.com/categories/access/' class="post_tag button button_translucent">
              ACCESS
              <span class="button_tally">4</span>
            </a>
            
            <a href='https://cloudtekki.com/categories/two-cents/' class="post_tag button button_translucent">
              TWO-CENTS
              <span class="button_tally">4</span>
            </a>
            
            <a href='https://cloudtekki.com/categories/author-notes/' class="post_tag button button_translucent">
              AUTHOR-NOTES
              <span class="button_tally">3</span>
            </a>
            
          </nav>
        </div>
        <div>
          <h2 class="mt-4 taxonomy" id="tags-section">TOP Tags</h2>
          <nav class="tags_nav">
            <a href='https://cloudtekki.com/tags/cloud-native/' class="post_tag button button_translucent">
              CLOUD-NATIVE
              <span class="button_tally">6</span>
            </a>
            
            <a href='https://cloudtekki.com/tags/event-driven/' class="post_tag button button_translucent">
              EVENT-DRIVEN
              <span class="button_tally">6</span>
            </a>
            
            <a href='https://cloudtekki.com/tags/access/' class="post_tag button button_translucent">
              ACCESS
              <span class="button_tally">4</span>
            </a>
            
            <a href='https://cloudtekki.com/tags/apis/' class="post_tag button button_translucent">
              APIS
              <span class="button_tally">4</span>
            </a>
            
            <a href='https://cloudtekki.com/tags/people/' class="post_tag button button_translucent">
              PEOPLE
              <span class="button_tally">4</span>
            </a>
            
          </nav>
        </div>
    </section>
  </div>
</aside>
<h1 class="single-title animated flipInX">Securing Outlook from Unmanaged Devices with Tunnel</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://www.linkedin.com/in/kteneyck/" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>Kevin Ten Eyck</a></span>&nbsp;<span class="post-category">included in <a href="/categories/euc/"><i class="far fa-folder fa-fw"></i>EUC</a></span><span class="sharebtns"><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://cloudtekki.com/post/tunnel-o365-conditional-access/" data-title="Securing Outlook from Unmanaged Devices with Tunnel" data-via="pkblah" data-hashtags="Tunnel,Office365,ConditionalAccess,WorkspaceONE"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="https://cloudtekki.com/post/tunnel-o365-conditional-access/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="Share on WhatsApp" data-sharer="whatsapp" data-url="https://cloudtekki.com/post/tunnel-o365-conditional-access/" data-title="Securing Outlook from Unmanaged Devices with Tunnel" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="Share on Reddit" data-sharer="reddit" data-url="https://cloudtekki.com/post/tunnel-o365-conditional-access/"><i class="fab fa-reddit fa-fw"></i></a><a href="javascript:void(0);" title="Share on Blogger" data-sharer="blogger" data-url="https://cloudtekki.com/post/tunnel-o365-conditional-access/" data-title="Securing Outlook from Unmanaged Devices with Tunnel" data-description=""><i class="fab fa-blogger fa-fw"></i></a></span>
            </div>
            <div class="post-meta-line">
                <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/tunnel/">Tunnel</a>,&nbsp;<a href="/tags/office365/">Office365</a>,&nbsp;<a href="/tags/conditionalaccess/">ConditionalAccess</a>,&nbsp;<a href="/tags/workspaceone/">WorkspaceONE</a></section><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-07-06">2021-07-06</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;2474 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;12 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#what-problem-does-this-solve">What problem does this solve?</a></li>
    <li><a href="#partner-compliance-conditional-access-option">Partner Compliance Conditional Access Option</a></li>
    <li><a href="#using-tunnel-and-uag">Using Tunnel and UAG!</a></li>
    <li><a href="#bandwidth-concerns-and-dtrs">Bandwidth Concerns and DTRs</a></li>
    <li><a href="#setup">Setup</a>
      <ul>
        <li><a href="#step-1-create-device-traffic-rules">Step 1: Create Device Traffic Rules</a></li>
        <li><a href="#step-2-create-a-trusted-location-in-azure-for-your-uag-public-ips">Step 2: Create A Trusted Location in Azure for your UAG Public IPs.</a></li>
        <li><a href="#step-3-create-an-azure-conditional-access-policy">Step 3: Create an Azure Conditional Access Policy</a></li>
        <li><a href="#step-4-test-and-validate-on-an-unenrolled-device-and-enrolled-device">Step 4: Test and Validate on an Unenrolled Device and Enrolled Device.</a></li>
        <li><a href="#results-and-gotchas">Results and Gotchas</a></li>
      </ul>
    </li>
    <li><a href="#compliance-and-azure-token-revoke-action">Compliance and Azure Token Revoke Action</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>Howdy! I&rsquo;m Kevin Ten Eyck, a Staff EUC Customer Success Architect at VMware. I&rsquo;ve been with VMware for 4 years and greatly enjoy all things EUC! Coming from a background in Mobility and VDI, I love finding new challenges to be solved. Would love to hear your feedback or alternate ideas on how you&rsquo;ve solved similar problems!</p>
<h2 id="what-problem-does-this-solve">What problem does this solve?</h2>
<p>This blog post is targeted at Workspace ONE UEM administrators who are being asked to prevent unmanaged devices from accessing Office 365 applications. Typically some of the biggest concerns center around, but aren&rsquo;t necessarily limited to:</p>
<ul>
<li>Access to the Outlook for iOS or Android application.</li>
<li>Access to applications like Teams or OneDrive.</li>
</ul>
<p>To be fair, the solution I am proposing is one of several methods. In fact, VMware and Microsoft have collaborated on an effort to allow Workspace ONE UEM device compliance status to be used to evaluate conditional access policies on Azure application. This is done by essentially daisy chaining the trust and device ID from the Authenticator app on a mobile device and using Workspace ONE Intelligence to communicate that status to Azure. It works fantastic, especially if you are already leveraging Authenticator as your MFA provider. However, it&rsquo;s not perfect and can be difficult to get rolled out. I&rsquo;ve provided some documentation below, in case you want to read up on the details.</p>
<ul>
<li><a href="https://docs.vmware.com/en/VMware-Workspace-ONE-UEM/services/Directory_Service_Integration/GUID-800FB831-AA66-4094-8F5A-FA5899A3C70C.html" target="_blank">Use Compliance data in Azure AD Conditional Access policies by integrating Workspace ONE UEM with Microsoft</a></li>
<li><a href="https://docs.microsoft.com/en-us/mem/intune/protect/create-conditional-access-intune" target="_blank">Create a Device-based Conditional Access Policy</a></li>
<li><a href="https://digitalworkspace.one/2020/05/12/compliance-api-msft/" target="_blank">Workspace One UEM 3rd party compliance integration  Microsoft Graph API</a></li>
</ul>
<h2 id="partner-compliance-conditional-access-option">Partner Compliance Conditional Access Option</h2>
<p>Some of the largest challenges around the above option are really human challenges. Namely:</p>
<ul>
<li>Requiring your users to install the Microsoft Authenticator App. This can be challenging if your user already has the app installed, or if they&rsquo;ve installed it outside of an Android Work Profile, for instance, where your managed apps will be deployed.</li>
<li>Requiring your users to manually register their device in Azure AD, beyond just installing the app and signing in for MFA challenges.</li>
<li>Requiring your users to tap on a web link you push to their device via the Hub Catalog or App Catalog, or try to sign in to a Conditional Access protected app and failing, which provides instructions on how to trigger VMware Intelligent Hub to &ldquo;trust&rdquo; the Microsoft Authenticator app. It&rsquo;s fraught with peril due to human error and requires your end-users to do something before they can be granted access.</li>
<li>Sometimes the device can take a while to populate in Azure&rsquo;s devices portal, which can cause false denials. We push compliance status in real time to Azure, but it can take a bit to reflect.</li>
<li>The conditional access policies in Azure are tied to some pretty broad categories, so you can require conditional access to all Office 365 apps, but couldn&rsquo;t explicitly allow unmanaged access to something like Microsoft Word, for instance. It&rsquo;s a bit of an all-or-nothing approach. You can get somewhat granular by selecting &ldquo;Exchange Online&rdquo; to prevent access just to Outlook app, but that also affects things like Teams.</li>
</ul>
<h2 id="using-tunnel-and-uag">Using Tunnel and UAG!</h2>
<p><strong>&ldquo;Well that all sounds difficult&rdquo;</strong>, you may be thinking. What can we do instead? I&rsquo;m glad you asked! There is a really simple and quick way to leverage the device trust you already have with your enrolled devices, and get more value out of the investment you&rsquo;ve already made in Workspace ONE Tunnel and the VMware Unified Access Gateways deployed.</p>
<p>The TL;DR of this article is this: We&rsquo;ll send our traffic through our UAGs, then tell Azure Conditional Access &ldquo;Devices coming from this IP are A-OK, let &lsquo;em through!&rdquo; while defaulting for all others (like an unmanaged mobile device, for example) to being denied access, or subject to some other conditional access policy if you prefer.</p>
<p>The nice thing is if you&rsquo;re already leveraging Tunnel and Per-App VPN then there aren&rsquo;t too many complicated steps needed!</p>
<h2 id="bandwidth-concerns-and-dtrs">Bandwidth Concerns and DTRs</h2>
<p><strong>&ldquo;But Kevin, sending all my email (or whatever O365 app) traffic through my UAGs sounds difficult and painful!&quot;</strong>
Fear not, reader! The good news is we can leverage not only Per-App VPN to only send traffic in the apps that we bless, but also specify the URLs that we want to send traffic through. Like, say for example&hellip;our O365 Login page only. This means that the Tunnel will kick in when the user on a managed devices launches an O365 app and tries to login, but the traffic after the login will process through their normal connection (outside the Tunnel).</p>
<p>Let&rsquo;s get into it!</p>
<h2 id="setup">Setup</h2>
<p><strong>Pre-requisite</strong>: If you haven&rsquo;t already deployed a Unified Access Gateway with Tunnel setup on Workspace ONE UEM, please read the following TechZone Articles and proceed after you have UAGs deployed with a public IP address and you can communicate with WS1 UEM successfully:</p>
<ul>
<li><a href="https://techzone.vmware.com/deploying-vmware-unified-access-gateway-workspace-one-operational-tutorial" target="_blank">1. Deploying VMware Unified Access Gateway</a>.</li>
<li><a href="https://techzone.vmware.com/configuring-vmware-tunnel-edge-service-workspace-one-operational-tutorial" target="_blank">2. Configure VMware Tunnel Service</a>.</li>
<li><a href="https://techzone.vmware.com/deploying-vmware-workspace-one-tunnel-workspace-one-operational-tutorial" target="_blank">3. How to Deploy and Configure Workspace ONE Tunnel App</a></li>
</ul>
<figure><a class="lightgallery" href="/img/euc/tunnel-o365-conditional-access/tunnel-api-success.png" title="/img/euc/tunnel-o365-conditional-access/tunnel-api-success.png" data-thumbnail="/img/euc/tunnel-o365-conditional-access/tunnel-api-success.png" data-sub-html="<h2>What your connection test should look like when your UAG can talk to UEM</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/euc/tunnel-o365-conditional-access/tunnel-api-success.png"
            data-srcset="/img/euc/tunnel-o365-conditional-access/tunnel-api-success.png, /img/euc/tunnel-o365-conditional-access/tunnel-api-success.png 1.5x, /img/euc/tunnel-o365-conditional-access/tunnel-api-success.png 2x"
            data-sizes="auto"
            alt="/img/euc/tunnel-o365-conditional-access/tunnel-api-success.png" />
    </a><figcaption class="image-caption">What your connection test should look like when your UAG can talk to UEM</figcaption>
    </figure>
<h3 id="step-1-create-device-traffic-rules">Step 1: Create Device Traffic Rules</h3>
<p>Remember that we only are interested in tunneling the traffic for the authentication into your O365 apps, not the app traffic itself. How we achieve this is by leveraging Device traffic Rules (DTRs). Here are the URLs that I&rsquo;ve supplied in my configuration. I also recommend adding something like ipchicken.com or whatismyip.com so you can validate from a web browser on a managed device that the traffic rules are applying correctly. (You should see the UAGs IP Address when visiting ipchicken rather than your Home IP address or Cellular IP address).</p>
<ul>
<li>To create or edit a device traffic rule you&rsquo;ll go to Groups &amp; Settings -&gt; Configurations -&gt; Tunnel.
<figure><a class="lightgallery" href="/img/euc/tunnel-o365-conditional-access/dtr-edit.png" title="/img/euc/tunnel-o365-conditional-access/dtr-edit.png" data-thumbnail="/img/euc/tunnel-o365-conditional-access/dtr-edit.png" data-sub-html="<h2>Click the Edit button to modify your rules</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/euc/tunnel-o365-conditional-access/dtr-edit.png"
            data-srcset="/img/euc/tunnel-o365-conditional-access/dtr-edit.png, /img/euc/tunnel-o365-conditional-access/dtr-edit.png 1.5x, /img/euc/tunnel-o365-conditional-access/dtr-edit.png 2x"
            data-sizes="auto"
            alt="/img/euc/tunnel-o365-conditional-access/dtr-edit.png" />
    </a><figcaption class="image-caption">Click the Edit button to modify your rules</figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/euc/tunnel-o365-conditional-access/dtr-edit2.png" title="/img/euc/tunnel-o365-conditional-access/dtr-edit2.png" data-thumbnail="/img/euc/tunnel-o365-conditional-access/dtr-edit2.png" data-sub-html="<h2>Choose your Per Application Assignment to edit by clicking on the Assignment Name</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/euc/tunnel-o365-conditional-access/dtr-edit2.png"
            data-srcset="/img/euc/tunnel-o365-conditional-access/dtr-edit2.png, /img/euc/tunnel-o365-conditional-access/dtr-edit2.png 1.5x, /img/euc/tunnel-o365-conditional-access/dtr-edit2.png 2x"
            data-sizes="auto"
            alt="/img/euc/tunnel-o365-conditional-access/dtr-edit2.png" />
    </a><figcaption class="image-caption">Choose your Per Application Assignment to edit by clicking on the Assignment Name</figcaption>
    </figure></li>
</ul>
<p>You&rsquo;ll want to create a new rule if you don&rsquo;t already have any traffic tunneled. Over on the left side you&rsquo;ll want to select what applications should traverse the Tunnel when a matched URL is found. This is how we can apply the conditional access only to apps that we bless from UEM. For example, in my screenshot below I have listed Teams and Outlook, but not Word or Powerpoint.
<figure><a class="lightgallery" href="/img/euc/tunnel-o365-conditional-access/dtr.png" title="/img/euc/tunnel-o365-conditional-access/dtr.png" data-thumbnail="/img/euc/tunnel-o365-conditional-access/dtr.png" data-sub-html="<h2>Device Traffic Rules for O365</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/euc/tunnel-o365-conditional-access/dtr.png"
            data-srcset="/img/euc/tunnel-o365-conditional-access/dtr.png, /img/euc/tunnel-o365-conditional-access/dtr.png 1.5x, /img/euc/tunnel-o365-conditional-access/dtr.png 2x"
            data-sizes="auto"
            alt="/img/euc/tunnel-o365-conditional-access/dtr.png" />
    </a><figcaption class="image-caption">Device Traffic Rules for O365</figcaption>
    </figure></p>
<ul>
<li>Your URL list in the freeform text box on the right should be a single line, separated by a comma and no spaces. Note that you cannot choose &ldquo;*&rdquo; as an endpoint, but you can use the wildcard to allow for subdomains.</li>
<li>In my example above, I&rsquo;ve listed login.microsoftonline.com,*.windows.net,ipchicken.com</li>
</ul>
<p><strong>Tip from the field</strong>: If you don&rsquo;t see your app of choice available to select in the dropdown on the left of your &ldquo;TUNNEL&rdquo; traffic rule, you may not have applied an SDK Policy, or have not allowed Tunnel in your SDK settings. Double check your apps to be certain!
<figure><a class="lightgallery" href="/img/euc/tunnel-o365-conditional-access/sdk-list.png" title="/img/euc/tunnel-o365-conditional-access/sdk-list.png" data-thumbnail="/img/euc/tunnel-o365-conditional-access/sdk-list.png" data-sub-html="<h2>What the list of apps available looks like</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/euc/tunnel-o365-conditional-access/sdk-list.png"
            data-srcset="/img/euc/tunnel-o365-conditional-access/sdk-list.png, /img/euc/tunnel-o365-conditional-access/sdk-list.png 1.5x, /img/euc/tunnel-o365-conditional-access/sdk-list.png 2x"
            data-sizes="auto"
            alt="/img/euc/tunnel-o365-conditional-access/sdk-list.png" />
    </a><figcaption class="image-caption">What the list of apps available looks like</figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/euc/tunnel-o365-conditional-access/sdk.png" title="/img/euc/tunnel-o365-conditional-access/sdk.png" data-thumbnail="/img/euc/tunnel-o365-conditional-access/sdk.png" data-sub-html="<h2>Check that your app has a SDK Profile selected</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/euc/tunnel-o365-conditional-access/sdk.png"
            data-srcset="/img/euc/tunnel-o365-conditional-access/sdk.png, /img/euc/tunnel-o365-conditional-access/sdk.png 1.5x, /img/euc/tunnel-o365-conditional-access/sdk.png 2x"
            data-sizes="auto"
            alt="/img/euc/tunnel-o365-conditional-access/sdk.png" />
    </a><figcaption class="image-caption">Check that your app has a SDK Profile selected</figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/euc/tunnel-o365-conditional-access/enablesecurity.png" title="/img/euc/tunnel-o365-conditional-access/enablesecurity.png" data-thumbnail="/img/euc/tunnel-o365-conditional-access/enablesecurity.png" data-sub-html="<h2>Check that your App Security settings allow for Tunnel and your DTRs are selected</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/euc/tunnel-o365-conditional-access/enablesecurity.png"
            data-srcset="/img/euc/tunnel-o365-conditional-access/enablesecurity.png, /img/euc/tunnel-o365-conditional-access/enablesecurity.png 1.5x, /img/euc/tunnel-o365-conditional-access/enablesecurity.png 2x"
            data-sizes="auto"
            alt="/img/euc/tunnel-o365-conditional-access/enablesecurity.png" />
    </a><figcaption class="image-caption">Check that your App Security settings allow for Tunnel and your DTRs are selected</figcaption>
    </figure></p>
<h3 id="step-2-create-a-trusted-location-in-azure-for-your-uag-public-ips">Step 2: Create A Trusted Location in Azure for your UAG Public IPs.</h3>
<p>We&rsquo;ll want to login as an Azure Admin and navigate to Conditional Access, then Named Locations.
<figure><a class="lightgallery" href="/img/euc/tunnel-o365-conditional-access/trusted-location1.png" title="/img/euc/tunnel-o365-conditional-access/trusted-location1.png" data-thumbnail="/img/euc/tunnel-o365-conditional-access/trusted-location1.png" data-sub-html="<h2>Click &lsquo;IP Ranges Location&rsquo; and populate it with your public IPs of your UAG appliances.</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/euc/tunnel-o365-conditional-access/trusted-location1.png"
            data-srcset="/img/euc/tunnel-o365-conditional-access/trusted-location1.png, /img/euc/tunnel-o365-conditional-access/trusted-location1.png 1.5x, /img/euc/tunnel-o365-conditional-access/trusted-location1.png 2x"
            data-sizes="auto"
            alt="/img/euc/tunnel-o365-conditional-access/trusted-location1.png" />
    </a><figcaption class="image-caption">Click &lsquo;IP Ranges Location&rsquo; and populate it with your public IPs of your UAG appliances.</figcaption>
    </figure></p>
<ul>
<li>You&rsquo;ll define single IP addresses with CIDR notation. For a single IP address you can provide it in the format of 1.2.3.4/32. If you need help with translating CIDR or creating a CIDR mask that will cover your UAG IPs, I recommend <a href="https://www.ipaddressguide.com/cidr" target="_blank">This Tool</a>
<figure><a class="lightgallery" href="/img/euc/tunnel-o365-conditional-access/trusted-location2.png" title="/img/euc/tunnel-o365-conditional-access/trusted-location2.png" data-thumbnail="/img/euc/tunnel-o365-conditional-access/trusted-location2.png" data-sub-html="<h2>Be sure to check the box for &lsquo;Trusted Location&rsquo;</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/euc/tunnel-o365-conditional-access/trusted-location2.png"
            data-srcset="/img/euc/tunnel-o365-conditional-access/trusted-location2.png, /img/euc/tunnel-o365-conditional-access/trusted-location2.png 1.5x, /img/euc/tunnel-o365-conditional-access/trusted-location2.png 2x"
            data-sizes="auto"
            alt="/img/euc/tunnel-o365-conditional-access/trusted-location2.png" />
    </a><figcaption class="image-caption">Be sure to check the box for &lsquo;Trusted Location&rsquo;</figcaption>
    </figure></li>
</ul>
<h3 id="step-3-create-an-azure-conditional-access-policy">Step 3: Create an Azure Conditional Access Policy</h3>
<p>In this step, we will be creating the conditional access policy (in this instance, for iOS).
-While still in the Azure Admin Portal under Conditional Access, click on &ldquo;Policies&rdquo; in the leftmost navigation tree.
<figure><a class="lightgallery" href="/img/euc/tunnel-o365-conditional-access/newpolicy.png" title="/img/euc/tunnel-o365-conditional-access/newpolicy.png" data-thumbnail="/img/euc/tunnel-o365-conditional-access/newpolicy.png" data-sub-html="<h2>Click &lsquo;&#43; New Policy&rsquo; to get started</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/euc/tunnel-o365-conditional-access/newpolicy.png"
            data-srcset="/img/euc/tunnel-o365-conditional-access/newpolicy.png, /img/euc/tunnel-o365-conditional-access/newpolicy.png 1.5x, /img/euc/tunnel-o365-conditional-access/newpolicy.png 2x"
            data-sizes="auto"
            alt="/img/euc/tunnel-o365-conditional-access/newpolicy.png" />
    </a><figcaption class="image-caption">Click &lsquo;+ New Policy&rsquo; to get started</figcaption>
    </figure></p>
<ul>
<li>Name your policy. Keep it descriptive and include the platform and/or apps included for future troubleshooting.</li>
<li>Select the Users and Groups you want affected. This is helpful when pilot testing to make sure you don&rsquo;t affect everyone while testing. (You <strong>are</strong> testing in a UAT environment, right?)</li>
<li>Select the Cloud apps or actions. In my example, I&rsquo;ve selected &lsquo;Office 365 Exchange Online&rsquo; and &lsquo;Apple Internet Account&rsquo; (for iOS Native Mail).
<figure><a class="lightgallery" href="/img/euc/tunnel-o365-conditional-access/cloudapps.png" title="/img/euc/tunnel-o365-conditional-access/cloudapps.png" data-thumbnail="/img/euc/tunnel-o365-conditional-access/cloudapps.png" data-sub-html="<h2>Cloud Apps Selected</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/euc/tunnel-o365-conditional-access/cloudapps.png"
            data-srcset="/img/euc/tunnel-o365-conditional-access/cloudapps.png, /img/euc/tunnel-o365-conditional-access/cloudapps.png 1.5x, /img/euc/tunnel-o365-conditional-access/cloudapps.png 2x"
            data-sizes="auto"
            alt="/img/euc/tunnel-o365-conditional-access/cloudapps.png" />
    </a><figcaption class="image-caption">Cloud Apps Selected</figcaption>
    </figure></li>
<li>Select the Conditions for your policy. In my example, I&rsquo;m targeted iOS, so for Device Platforms, click &lsquo;Not configured&rsquo; under Device Platforms and choose Configure -&gt; &lsquo;Yes&rsquo; -&gt; Include -&gt; Selected device platform -&gt; Check the box for &lsquo;iOS&rsquo;.
<figure><a class="lightgallery" href="/img/euc/tunnel-o365-conditional-access/platforms.png" title="/img/euc/tunnel-o365-conditional-access/platforms.png" data-thumbnail="/img/euc/tunnel-o365-conditional-access/platforms.png" data-sub-html="<h2>Platform Selected</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/euc/tunnel-o365-conditional-access/platforms.png"
            data-srcset="/img/euc/tunnel-o365-conditional-access/platforms.png, /img/euc/tunnel-o365-conditional-access/platforms.png 1.5x, /img/euc/tunnel-o365-conditional-access/platforms.png 2x"
            data-sizes="auto"
            alt="/img/euc/tunnel-o365-conditional-access/platforms.png" />
    </a><figcaption class="image-caption">Platform Selected</figcaption>
    </figure></li>
<li>While still in the Conditions, click on &lsquo;Not configured&rsquo; under Locations.</li>
<li>Select Configure -&gt; Yes -&gt; Include -&gt; Choose &lsquo;Any location&rsquo;. ALSO in this same tab, click on &lsquo;Exclude&rsquo; and choose &lsquo;Selected Locations&rsquo; then pick your &lsquo;UAG&rsquo; Location Range defined earlier.
<figure><a class="lightgallery" href="/img/euc/tunnel-o365-conditional-access/locations1.png" title="/img/euc/tunnel-o365-conditional-access/locations1.png" data-thumbnail="/img/euc/tunnel-o365-conditional-access/locations1.png" data-sub-html="<h2>Making sure all locations are affected by this policy.</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/euc/tunnel-o365-conditional-access/locations1.png"
            data-srcset="/img/euc/tunnel-o365-conditional-access/locations1.png, /img/euc/tunnel-o365-conditional-access/locations1.png 1.5x, /img/euc/tunnel-o365-conditional-access/locations1.png 2x"
            data-sizes="auto"
            alt="/img/euc/tunnel-o365-conditional-access/locations1.png" />
    </a><figcaption class="image-caption">Making sure all locations are affected by this policy.</figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/euc/tunnel-o365-conditional-access/locations2.png" title="/img/euc/tunnel-o365-conditional-access/locations2.png" data-thumbnail="/img/euc/tunnel-o365-conditional-access/locations2.png" data-sub-html="<h2>Excluding your UAG&rsquo;s public IP addresses from this policy.</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/euc/tunnel-o365-conditional-access/locations2.png"
            data-srcset="/img/euc/tunnel-o365-conditional-access/locations2.png, /img/euc/tunnel-o365-conditional-access/locations2.png 1.5x, /img/euc/tunnel-o365-conditional-access/locations2.png 2x"
            data-sizes="auto"
            alt="/img/euc/tunnel-o365-conditional-access/locations2.png" />
    </a><figcaption class="image-caption">Excluding your UAG&rsquo;s public IP addresses from this policy.</figcaption>
    </figure></li>
<li>Under &lsquo;Access Controls&rsquo; select &lsquo;Grant&rsquo; and choose &lsquo;Block Access&rsquo;. This is what happens to clients who are NOT coming from the UAG IP address range.
<figure><a class="lightgallery" href="/img/euc/tunnel-o365-conditional-access/grantdeny.png" title="/img/euc/tunnel-o365-conditional-access/grantdeny.png" data-thumbnail="/img/euc/tunnel-o365-conditional-access/grantdeny.png" data-sub-html="<h2>This portion defines what should happen when this policy does apply (non UAG IPs).</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/euc/tunnel-o365-conditional-access/grantdeny.png"
            data-srcset="/img/euc/tunnel-o365-conditional-access/grantdeny.png, /img/euc/tunnel-o365-conditional-access/grantdeny.png 1.5x, /img/euc/tunnel-o365-conditional-access/grantdeny.png 2x"
            data-sizes="auto"
            alt="/img/euc/tunnel-o365-conditional-access/grantdeny.png" />
    </a><figcaption class="image-caption">This portion defines what should happen when this policy does apply (non UAG IPs).</figcaption>
    </figure></li>
</ul>
<p>This will effectively make this policy apply to all iOS Devices trying to access Exchange Online and require their authentication request to originate from a UAG&rsquo;s public IP address.</p>
<h3 id="step-4-test-and-validate-on-an-unenrolled-device-and-enrolled-device">Step 4: Test and Validate on an Unenrolled Device and Enrolled Device.</h3>
<p>The last step is to make the policy active. For testing, you&rsquo;ll want to scope this to a test group of users until you know everything is working properly.
<figure><a class="lightgallery" href="/img/euc/tunnel-o365-conditional-access/enable.png" title="/img/euc/tunnel-o365-conditional-access/enable.png" data-thumbnail="/img/euc/tunnel-o365-conditional-access/enable.png" data-sub-html="<h2>Enabling your policy make some time to be effective. I&rsquo;d give it 15 minutes or so before you test.</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/euc/tunnel-o365-conditional-access/enable.png"
            data-srcset="/img/euc/tunnel-o365-conditional-access/enable.png, /img/euc/tunnel-o365-conditional-access/enable.png 1.5x, /img/euc/tunnel-o365-conditional-access/enable.png 2x"
            data-sizes="auto"
            alt="/img/euc/tunnel-o365-conditional-access/enable.png" />
    </a><figcaption class="image-caption">Enabling your policy make some time to be effective. I&rsquo;d give it 15 minutes or so before you test.</figcaption>
    </figure></p>
<div class="details admonition failure open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-times-circle fa-fw"></i>Troubleshooting Tips<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><ul>
<li>If a user is being denied that should be granted access, first check that a conflicting Azure Conditional Access Policy isn&rsquo;t applying to the user or device. This logging should be available in the Azure Portal under <a href="https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/SignIns" target="_blank">Monitoring - Sign-Ins</a>.</li>
<li>In the sign in logs, you&rsquo;ll see the Username, IP address, Application, User-Agent, Device Info (Browser, iOS Version, etc.). There is also a tab for Conditional Access under each log entry that will tell you which Conditional Access Policies were applied and whether they were successful or not. Under each entry, you can click the &lsquo;&hellip;&rsquo; icon and select &lsquo;Show details&hellip;&rsquo; to get in depth details on what from the policy matched. You get a helpful image that shows a check boxes for each assignment and condition, as well as access controls.</li>
</ul>
<figure><a class="lightgallery" href="/img/euc/tunnel-o365-conditional-access/troubleshooting1.png" title="/img/euc/tunnel-o365-conditional-access/troubleshooting1.png" data-thumbnail="/img/euc/tunnel-o365-conditional-access/troubleshooting1.png" data-sub-html="<h2>A Sample Sign-In Log Entry</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/euc/tunnel-o365-conditional-access/troubleshooting1.png"
            data-srcset="/img/euc/tunnel-o365-conditional-access/troubleshooting1.png, /img/euc/tunnel-o365-conditional-access/troubleshooting1.png 1.5x, /img/euc/tunnel-o365-conditional-access/troubleshooting1.png 2x"
            data-sizes="auto"
            alt="/img/euc/tunnel-o365-conditional-access/troubleshooting1.png" />
    </a><figcaption class="image-caption">A Sample Sign-In Log Entry</figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/euc/tunnel-o365-conditional-access/troubleshooting1a.png" title="/img/euc/tunnel-o365-conditional-access/troubleshooting1a.png" data-thumbnail="/img/euc/tunnel-o365-conditional-access/troubleshooting1a.png" data-sub-html="<h2>Conditional Access Policies Matched</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/euc/tunnel-o365-conditional-access/troubleshooting1a.png"
            data-srcset="/img/euc/tunnel-o365-conditional-access/troubleshooting1a.png, /img/euc/tunnel-o365-conditional-access/troubleshooting1a.png 1.5x, /img/euc/tunnel-o365-conditional-access/troubleshooting1a.png 2x"
            data-sizes="auto"
            alt="/img/euc/tunnel-o365-conditional-access/troubleshooting1a.png" />
    </a><figcaption class="image-caption">Conditional Access Policies Matched</figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/euc/tunnel-o365-conditional-access/troubleshooting2.png" title="/img/euc/tunnel-o365-conditional-access/troubleshooting2.png" data-thumbnail="/img/euc/tunnel-o365-conditional-access/troubleshooting2.png" data-sub-html="<h2>Conditional Access Details Expanded</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/euc/tunnel-o365-conditional-access/troubleshooting2.png"
            data-srcset="/img/euc/tunnel-o365-conditional-access/troubleshooting2.png, /img/euc/tunnel-o365-conditional-access/troubleshooting2.png 1.5x, /img/euc/tunnel-o365-conditional-access/troubleshooting2.png 2x"
            data-sizes="auto"
            alt="/img/euc/tunnel-o365-conditional-access/troubleshooting2.png" />
    </a><figcaption class="image-caption">Conditional Access Details Expanded</figcaption>
    </figure>
<ul>
<li>Also, if the Sign-In logs show Successful, but the user sees an error message indicating that they failed to sign in, there may be a conflicting App Protection Policy from the endpoint management perspective.</li>
</ul>
<figure><a class="lightgallery" href="/img/euc/tunnel-o365-conditional-access/failedtosignin.png" title="/img/euc/tunnel-o365-conditional-access/failedtosignin.png" data-thumbnail="/img/euc/tunnel-o365-conditional-access/failedtosignin.png" data-sub-html="<h2>This error typically means there was a conflict or issue from the Intune Endpoint App Protection Policies.</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/euc/tunnel-o365-conditional-access/failedtosignin.png"
            data-srcset="/img/euc/tunnel-o365-conditional-access/failedtosignin.png, /img/euc/tunnel-o365-conditional-access/failedtosignin.png 1.5x, /img/euc/tunnel-o365-conditional-access/failedtosignin.png 2x"
            data-sizes="auto"
            alt="/img/euc/tunnel-o365-conditional-access/failedtosignin.png" width="50%" />
    </a><figcaption class="image-caption">This error typically means there was a conflict or issue from the Intune Endpoint App Protection Policies.</figcaption>
    </figure>
<ul>
<li>For validation that you have the Outlook app added correctly to be tunneled, as of Tunnel for iOS 21.04, you now have the ability to see configured applications directly within the Tunnel client. This can be enabled by adding the key-value pair DisplayAppAccessList = true to the app config when pushing the app.</li>
</ul>
<figure><a class="lightgallery" href="/img/euc/tunnel-o365-conditional-access/allowedapps.png" title="/img/euc/tunnel-o365-conditional-access/allowedapps.png" data-thumbnail="/img/euc/tunnel-o365-conditional-access/allowedapps.png" data-sub-html="<h2>Your end user device will be able to see what apps are allowed to use Tunnel with the KVP above.</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/euc/tunnel-o365-conditional-access/allowedapps.png"
            data-srcset="/img/euc/tunnel-o365-conditional-access/allowedapps.png, /img/euc/tunnel-o365-conditional-access/allowedapps.png 1.5x, /img/euc/tunnel-o365-conditional-access/allowedapps.png 2x"
            data-sizes="auto"
            alt="/img/euc/tunnel-o365-conditional-access/allowedapps.png" width="50%" />
    </a><figcaption class="image-caption">Your end user device will be able to see what apps are allowed to use Tunnel with the KVP above.</figcaption>
    </figure>
</div>
        </div>
    </div>
<h3 id="results-and-gotchas">Results and Gotchas</h3>
<ul>
<li>
<p>The expected experience is that when an enrolled device launches a managed app that we&rsquo;ve added to our Device Traffic Rules, and it matches an Azure Conditional Access Policy - the Tunnel Per-App VPN should kick in, but only during authentication. The managed device will be coming from the Tunnel UAG IP address, and therefore be allowed through without any further authentication needed. If you&rsquo;re leveraging Workspace ONE Access and UEM for Mobile SSO in Azure AD, you could even make the sign in process fairly transparent for your end-users.

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube-nocookie.com/embed/SVmkbYc399c" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>
</p>
</li>
<li>
<p>The expected experience for a non-enrolled device is that when they authenticate, they&rsquo;ll hit the policy that says &lsquo;if you&rsquo;re not coming from one of these IPs, then I am supposed to deny you.&rsquo; &ndash; they&rsquo;ll get a sign in failed error message that lets them know they didn&rsquo;t meet the conditions needed to sign in.

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube-nocookie.com/embed/Vkn0YeKNB-M" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>
</p>
</li>
</ul>
<h2 id="compliance-and-azure-token-revoke-action">Compliance and Azure Token Revoke Action</h2>
<p>This is all great - but what happens if a device falls out of compliance? How do you make sure they are logged out of their O365 apps? Compliance engine to the rescue!</p>
<ul>
<li>To ensure that devices that are non-compliant or are enterprise wiped lose access to the O365 apps, I highly recommend leveraging our Compliance engine&rsquo;s action of &lsquo;Azure Token Revoke&rsquo;. You can read more about it in our <a href="https://docs.vmware.com/en/VMware-Workspace-ONE-UEM/services/UEM_Managing_Devices/GUID-AWT-COMPLIANCEPOLICYACTIONSBYPLATFORM.html?hWord=N4IghgNiBc4F4FcBOBTABAFwPYGsUDsQBfIA" target="_blank">documentation</a>.</li>
<li>Please note that this requires &lsquo;Use Azure AD For Identity Services&rsquo; enablement in Settings &gt; System &gt; Enterprise Integration &gt; Directory Services &gt; Advanced. Also important to note that this action affects all devices for a given user, disabling any app that relies upon the Azure token. So they&rsquo;ll need to sign in again on any device leveraging the Azure token.</li>
</ul>
<p>Check the video below for an overview of this functionality.</p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube-nocookie.com/embed/Y1bDFZEgVuY" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<p>One final gotcha is that some of the O365 mobile apps share authentication tokens, so you&rsquo;ll need to think through what applications you are trying to allow through and which ones you are trying to deny access to. An example is that if you create a conditional access policy for Exchange Online, you&rsquo;ll also be affecting Teams and Sharepoint mobile, as they rely on functionality between apps.</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2021-07-09&nbsp;<a class="git-hash" href="https://github.com/pksrc/commit/ed371b30c612d3219a361646c7d3074a0f6b86a3" target="_blank" title="commit by t4ckevint(t4ckevint@gmail.com) ed371b30c612d3219a361646c7d3074a0f6b86a3: Creating my first blog. I am all grown up. (#11)">
                                    <i class="fas fa-hashtag fa-fw"></i>ed371b3</a></span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share sharebtns">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://cloudtekki.com/post/tunnel-o365-conditional-access/" data-title="Securing Outlook from Unmanaged Devices with Tunnel" data-via="pkblah" data-hashtags="Tunnel,Office365,ConditionalAccess,WorkspaceONE"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="https://cloudtekki.com/post/tunnel-o365-conditional-access/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="Share on WhatsApp" data-sharer="whatsapp" data-url="https://cloudtekki.com/post/tunnel-o365-conditional-access/" data-title="Securing Outlook from Unmanaged Devices with Tunnel" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="Share on Reddit" data-sharer="reddit" data-url="https://cloudtekki.com/post/tunnel-o365-conditional-access/"><i class="fab fa-reddit fa-fw"></i></a><a href="javascript:void(0);" title="Share on Blogger" data-sharer="blogger" data-url="https://cloudtekki.com/post/tunnel-o365-conditional-access/" data-title="Securing Outlook from Unmanaged Devices with Tunnel" data-description=""><i class="fab fa-blogger fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/tunnel/">Tunnel</a>,&nbsp;<a href="/tags/office365/">Office365</a>,&nbsp;<a href="/tags/conditionalaccess/">ConditionalAccess</a>,&nbsp;<a href="/tags/workspaceone/">WorkspaceONE</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/post/eso/" class="prev" rel="prev" title="Edge Services Observability for Unified Access Gateway"><i class="fas fa-angle-left fa-fw"></i>Edge Services Observability for Unified Access Gateway</a>
            <a href="/post/the-flip-side/" class="next" rel="next" title="Welcome to the Flip Side">Welcome to the Flip Side<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="utterances"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://utteranc.es/">Utterances</a>.
            </noscript></div></article><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div><h2 class="twitter-title">TWEETS</h2>
            <div class="twitterfeed" id="twitter-auto" >
                <a class="twitter-timeline" data-width="300" data-height="600" data-dnt="true" data-chrome="noborders nofooter noheader" href="https://twitter.com/pkblah">Tweets by pkblah</a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 
            </div></div></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><p><a href="/"><img src="/img/logo/cloud-tekki-logo.png" alt="CLOUD TEKKI" style="height:4rem"/></a></p> Powered by Hugo | Github Pages</div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2008 - 2021</span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.8/lunr.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/js/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.2.0/dist/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":80},"comment":{"utterances":{"darkTheme":"github-dark","issueTerm":"pathname","label":"","lightTheme":"github-light","repo":"pksrc/cloudtekki"}},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/lib/stripe-menu/menu.js"></script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-RYVG6M042F', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-RYVG6M042F" async></script></body>
</html>
